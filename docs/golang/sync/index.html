<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
go sync 包在go语言并发编程中必不可少，本文介绍go sync包中各个接口的使用方法以及示例
">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="golang sync包的使用" />
<meta property="og:description" content="
go sync 包在go语言并发编程中必不可少，本文介绍go sync包中各个接口的使用方法以及示例
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jageros.github.io/note/docs/golang/sync/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2021-08-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-08-03T00:00:00+00:00" />

<title>golang sync包的使用 | Jager&#39;s Note</title>
<link rel="manifest" href="/note/manifest.json">
<link rel="icon" href="/note/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/note/book.min.958cea7827621d6fbcb3acf091344c3e44e3d2a9428f9c3c38bb9eb37bf8c45d.css" integrity="sha256-lYzqeCdiHW&#43;8s6zwkTRMPkTj0qlCj5w8OLues3v4xF0=" crossorigin="anonymous">
  <script defer src="/note/flexsearch.min.js"></script>
  <script defer src="/note/en.search.min.3e0046501574ff56f401d449ab48cbfa67228890aa5f42e01b31f926ed9601f5.js" integrity="sha256-PgBGUBV0/1b0AdRJq0jL&#43;mciiJCqX0LgGzH5Ju2WAfU=" crossorigin="anonymous"></script>

  <script defer src="/note/sw.min.4bb0a7c3ceb8eb699335ae168b1ce1699c0dfd35743b4318c4ae80fe6359ad42.js" integrity="sha256-S7Cnw86462mTNa4WixzhaZwN/TV0O0MYxK6A/mNZrUI=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a href="/note/"><span>Jager&#39;s Note</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  



  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6ae1a891fb3a3f71d71273fc61b29b76" class="toggle"  />
    <label for="section-6ae1a891fb3a3f71d71273fc61b29b76" class="flex justify-between">
      <a href="https://jageros.github.io/note/docs/linux/" class="">Linux</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/linux/operate-recode/" class="">Linux不常用操作记录</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-365aea7c1bb9b13879d76e6d87869a68" class="toggle" checked />
    <label for="section-365aea7c1bb9b13879d76e6d87869a68" class="flex justify-between">
      <a href="https://jageros.github.io/note/docs/golang/" class="">Go语言笔记</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/golang/viper/" class="">viper配置示例</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/golang/go-pkg/" class="">go第三方库列表</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/golang/channel/" class="">channel注意事项</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/golang/sync/" class=" active">golang sync包的使用</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/golang/study-line/" class="">go服务端开发学习指南</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/golang/grace-exit/" class="">go程序优雅退出</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/golang/eventhub/" class="">go程序发布监听事件库</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/golang/queue/" class="">queue golang实现</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/golang/other-recode/" class="">零碎笔记</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e28cc33fe5745d14abf4a0147d0624a5" class="toggle"  />
    <label for="section-e28cc33fe5745d14abf4a0147d0624a5" class="flex justify-between">
      <a href="https://jageros.github.io/note/docs/database/" class="">数据库相关</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/database/mongodb/" class="">MongoDB的一些操作记录</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f55a7674027409a03b8a5abb4bc297a8" class="toggle"  />
    <label for="section-f55a7674027409a03b8a5abb4bc297a8" class="flex justify-between">
      <a href="https://jageros.github.io/note/docs/nginx/" class="">Nginx</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/nginx/nginxop/" class="">Nginx命令操作记录</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/nginx/nginx-limit/" class="">Nginx IP 限流</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/nginx/proxy/" class="">nginx反向代理</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9db18fd45042d0a8d3641d782c558c9b" class="toggle"  />
    <label for="section-9db18fd45042d0a8d3641d782c558c9b" class="flex justify-between">
      <a href="https://jageros.github.io/note/docs/etcd/" class="">Etcd</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-938c2e3eb0a698b650d245dc2f5577c9" class="toggle"  />
    <label for="section-938c2e3eb0a698b650d245dc2f5577c9" class="flex justify-between">
      <a href="https://jageros.github.io/note/docs/queue/" class="">消息队列</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-49329833618cf26156c77f35cef1c5a2" class="toggle"  />
    <label for="section-49329833618cf26156c77f35cef1c5a2" class="flex justify-between">
      <a href="https://jageros.github.io/note/docs/elasticsearch/" class="">Elasticsearch</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/elasticsearch/elasticsearch-install/" class="">Elasticsearch部署</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-87f45e72e9046a94302e37ea137e2a5c" class="toggle"  />
    <label for="section-87f45e72e9046a94302e37ea137e2a5c" class="flex justify-between">
      <a href="https://jageros.github.io/note/docs/kubernetes/" class="">Kubernetes</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/kubernetes/kubernetes-setup/" class="">Kubernetes服务部署步骤</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-353f7a5578fa41dbc42c73ea30fe2255" class="toggle"  />
    <label for="section-353f7a5578fa41dbc42c73ea30fe2255" class="flex justify-between">
      <a href="https://jageros.github.io/note/docs/algorithm/" class="">算法知识</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/algorithm/random-n-int/" class="">生成x个随机数</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9f0c33c6c213ccb5fe71280fe3c278ea" class="toggle"  />
    <label for="section-9f0c33c6c213ccb5fe71280fe3c278ea" class="flex justify-between">
      <a href="https://jageros.github.io/note/docs/interview/" class="">面试相关笔记</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/interview/interview/" class="">面经</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/interview/plan/" class="">面试准备</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/interview/faq/" class="">面试灵魂拷问</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c491ef2d3236e510d8223043b6cb170f" class="toggle"  />
    <label for="section-c491ef2d3236e510d8223043b6cb170f" class="flex justify-between">
      <a href="https://jageros.github.io/note/docs/material/" class="">学习资料</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/material/reference/" class="">参考博客文献</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-df0032c292233614eb120498739e8356" class="toggle"  />
    <label for="section-df0032c292233614eb120498739e8356" class="flex justify-between">
      <a href="https://jageros.github.io/note/docs/other/" class="">其他笔记</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/other/mac/" class="">其他记录</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2f39d40212b08dcd8ceb6c3fbe0886d8" class="toggle"  />
    <label for="section-2f39d40212b08dcd8ceb6c3fbe0886d8" class="flex justify-between">
      <a href="https://jageros.github.io/note/docs/fund/" class="">基金数据</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/fund/funds/" class="">基金数据分析</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-7938cf87f880a38cdf014f05114ed748" class="toggle"  />
    <label for="section-7938cf87f880a38cdf014f05114ed748" class="flex justify-between">
      <a href="https://jageros.github.io/note/docs/scheme/" class="">项目实践</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/scheme/werewolf/" class="">狼人对决项目方案</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a4e43754b57e48a59ea384b542052e04" class="toggle"  />
    <label for="section-a4e43754b57e48a59ea384b542052e04" class="flex justify-between">
      <a href="https://jageros.github.io/note/docs/geomancy/" class="">风水知识</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://jageros.github.io/note/docs/geomancy/basics/" class="">风水入门知识</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ce2f1594fa3d18bb5604540e4de080b5" class="toggle"  />
    <label for="section-ce2f1594fa3d18bb5604540e4de080b5" class="flex justify-between">
      <a href="https://jageros.github.io/note/docs/life/" class="">生活日志</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="https://github.com/jageros" target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
  <li>
    <a href="https://blog.csdn.net/lhj_168" target="_blank" rel="noopener">
        CSDN
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/note/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>golang sync包的使用</strong>

  <label for="toc-control">
    
    <img src="/note/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#type-once"><code>type Once</code></a></li>
        <li><a href="#type-waitgroup"><code>type WaitGroup</code></a></li>
        <li><a href="#type-locker"><code>type Locker</code></a></li>
        <li><a href="#type-rwmutex"><code>type RWMutex</code></a></li>
        <li><a href="#type-cond-"><code>type Cond </code></a></li>
        <li><a href="#type-pool"><code>type Pool</code></a></li>
        <li><a href="#type-map"><code>type Map</code></a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
<article class="markdown">
  <h1>
    <a href="/note/docs/golang/sync/">golang sync包的使用</a>
  </h1>
  
  <h5>2021-08-03</h5>



  

  
  <div>
    
      <a href="/note/tags/go/">go</a>, 
      <a href="/note/tags/sync/">sync</a>
  </div>
  



<blockquote>
<p>go sync 包在go语言并发编程中必不可少，本文介绍go sync包中各个接口的使用方法以及示例</p>
</blockquote>
<h2 id="type-once">
  <code>type Once</code>
  <a class="anchor" href="#type-once">#</a>
</h2>
<p>功能: 确保函数只执行一次</p>
<p>结构定义：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Once</span> <span style="color:#66d9ef">struct</span> {
        <span style="color:#75715e">// contains filtered or unexported fields
</span><span style="color:#75715e"></span>}

<span style="color:#75715e">//function list：
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">o</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Once</span>) <span style="color:#a6e22e">Do</span>(<span style="color:#a6e22e">f</span> <span style="color:#66d9ef">func</span>())
</code></pre></div><p>用法示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;sync&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">once</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">Once</span>
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">two</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">Once</span>
	<span style="color:#a6e22e">onceBody</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">func</span>() {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Only once&#34;</span>)
	}
	<span style="color:#a6e22e">twoBody</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">func</span>() {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;two once&#34;</span>)
	}
	<span style="color:#a6e22e">done</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">bool</span>)
	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">10</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
		<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
			<span style="color:#a6e22e">once</span>.<span style="color:#a6e22e">Do</span>(<span style="color:#a6e22e">onceBody</span>)
			<span style="color:#a6e22e">done</span> <span style="color:#f92672">&lt;-</span> <span style="color:#66d9ef">true</span>
		}()
	}
	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">10</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
		<span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">done</span>
	}
	<span style="color:#a6e22e">two</span>.<span style="color:#a6e22e">Do</span>(<span style="color:#a6e22e">twoBody</span>)
	<span style="color:#a6e22e">two</span>.<span style="color:#a6e22e">Do</span>(<span style="color:#a6e22e">twoBody</span>)
}
</code></pre></div><p>输出：</p>
<pre><code>Only once
two once
</code></pre><hr>
<h2 id="type-waitgroup">
  <code>type WaitGroup</code>
  <a class="anchor" href="#type-waitgroup">#</a>
</h2>
<p>功能：
用于等待协程结束，每起一个goroutine之前Add(1),每个goroutine完成退出前Done()，主线程中用Wait()阻塞等待所有goroutine退出。</p>
<p>结构定义：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">WaitGroup</span> <span style="color:#66d9ef">struct</span> {
        <span style="color:#75715e">// contains filtered or unexported fields
</span><span style="color:#75715e"></span>}

<span style="color:#75715e">//function list:
</span><span style="color:#75715e">// 计数器增加delta，表示增加delta个goroutine
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">wg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">WaitGroup</span>) <span style="color:#a6e22e">Add</span>(<span style="color:#a6e22e">delta</span> <span style="color:#66d9ef">int</span>)  

<span style="color:#75715e">// 计数器减1，表示一个goroutine执行完成
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">wg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">WaitGroup</span>) <span style="color:#a6e22e">Done</span>()  

 <span style="color:#75715e">// 挂起等待计数器归零        
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">wg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">WaitGroup</span>) <span style="color:#a6e22e">Wait</span>()         
</code></pre></div><p>示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;sync&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">tt</span>(<span style="color:#a6e22e">wg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>, <span style="color:#a6e22e">i</span> <span style="color:#66d9ef">int</span>) {
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>()
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;goroutine: %d\n&#34;</span>, <span style="color:#a6e22e">i</span>)
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">wg</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>{}
	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">10</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
		<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">1</span>)
		<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">tt</span>(<span style="color:#a6e22e">wg</span>, <span style="color:#a6e22e">i</span>)

	}
	<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Wait</span>()
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Run end!&#34;</span>)
}
</code></pre></div><p>输出：</p>
<pre><code>goroutine: 9
goroutine: 6
goroutine: 7
goroutine: 8
goroutine: 3
goroutine: 2
goroutine: 4
goroutine: 1
goroutine: 5
goroutine: 0
Run end!
</code></pre><hr>
<h2 id="type-locker">
  <code>type Locker</code>
  <a class="anchor" href="#type-locker">#</a>
</h2>
<p>功能：
确保资源只被一个goroutine占有</p>
<p>结构定义：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Locker</span> <span style="color:#66d9ef">interface</span> {
        <span style="color:#a6e22e">Lock</span>()     <span style="color:#75715e">// 上锁，在已锁的状态下此函数阻塞，直到锁被释放
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">Unlock</span>()   <span style="color:#75715e">// 用于释放锁，在无锁的状态下执行会报错
</span><span style="color:#75715e"></span>}
</code></pre></div><p>示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> ( 	<span style="color:#e6db74">&#34;fmt&#34;</span> 	<span style="color:#e6db74">&#34;sync&#34;</span> 	<span style="color:#e6db74">&#34;time&#34;</span> )

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">tt</span>(<span style="color:#a6e22e">w</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>, <span style="color:#a6e22e">l</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">Mutex</span>, <span style="color:#a6e22e">i</span> <span style="color:#66d9ef">int</span>) { 	
    <span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;End Goroutine: %d\n&#34;</span>, <span style="color:#a6e22e">i</span>) 		
		<span style="color:#a6e22e">l</span>.<span style="color:#a6e22e">Unlock</span>() 		
		<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Done</span>() 	
	}()
	<span style="color:#a6e22e">l</span>.<span style="color:#a6e22e">Lock</span>() 	
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;lock: %d\n&#34;</span>, <span style="color:#a6e22e">i</span>) 	
	<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>) 
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() { 	
    <span style="color:#a6e22e">l</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">Mutex</span>{} 	
    <span style="color:#a6e22e">w</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>{} 	
    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">10</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> { 		
        <span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">1</span>) 		
        <span style="color:#66d9ef">go</span> <span style="color:#a6e22e">tt</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">l</span>, <span style="color:#a6e22e">i</span>) 	
    }
    <span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Wait</span>() 	
    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Run end!&#34;</span>) 
}
</code></pre></div><p>输出：</p>
<pre><code>lock: 1
End Goroutine: 1
lock: 9
End Goroutine: 9
lock: 2
End Goroutine: 2
lock: 3
End Goroutine: 3
lock: 4
End Goroutine: 4
lock: 5
End Goroutine: 5
lock: 6
End Goroutine: 6
lock: 7
End Goroutine: 7
lock: 8
End Goroutine: 8
lock: 0
End Goroutine: 0
Run end!
</code></pre><hr>
<h2 id="type-rwmutex">
  <code>type RWMutex</code>
  <a class="anchor" href="#type-rwmutex">#</a>
</h2>
<p>功能：
RWMutex 是单写多读锁，读锁占用的情况下会阻止写，不会阻止读，多个goroutine可以同时获取读锁，写锁会阻止其他goroutine（无论读和写）进来，整个锁由该 goroutine独占，适用于读多写少的场景.</p>
<p>PS：读共享，写独占，写优先</p>
<p>结构定义：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RWMutex</span> <span style="color:#66d9ef">struct</span> {
        <span style="color:#75715e">// contains filtered or unexported fields
</span><span style="color:#75715e"></span>}

<span style="color:#75715e">//function list
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">rw</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">RWMutex</span>) <span style="color:#a6e22e">Lock</span>()  <span style="color:#75715e">// 写加锁
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">rw</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">RWMutex</span>) <span style="color:#a6e22e">RLock</span>()  <span style="color:#75715e">// 读加锁
</span><span style="color:#75715e">// 返回一个实现Lock和Unlock方法的Locker接口，用于调用rw.RLock和rw.RUnlock来实现读锁的加锁和解锁。
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">rw</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">RWMutex</span>) <span style="color:#a6e22e">RLocker</span>() <span style="color:#a6e22e">Locker</span>  
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">rw</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">RWMutex</span>) <span style="color:#a6e22e">RUnlock</span>()  <span style="color:#75715e">// 读解锁
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">rw</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">RWMutex</span>) <span style="color:#a6e22e">Unlock</span>()  <span style="color:#75715e">// 写解锁
</span></code></pre></div><p>示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;math/rand&#34;</span>
	<span style="color:#e6db74">&#34;sync&#34;</span>
	<span style="color:#e6db74">&#34;time&#34;</span>
)

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">value</span> <span style="color:#66d9ef">int</span>

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">writes</span>(<span style="color:#a6e22e">i</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">wg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>, <span style="color:#a6e22e">rwM</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">RWMutex</span>) {
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>()

	<span style="color:#66d9ef">for</span> {
		<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Seed</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">Unix</span>())
		<span style="color:#a6e22e">num</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Intn</span>(<span style="color:#ae81ff">100</span>)
		<span style="color:#a6e22e">rwM</span>.<span style="color:#a6e22e">Lock</span>()
		<span style="color:#a6e22e">value</span> = <span style="color:#a6e22e">num</span>
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;writes goroutine:%d, Write num=%d\n&#34;</span>, <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">num</span>)
		<span style="color:#a6e22e">rwM</span>.<span style="color:#a6e22e">Unlock</span>()
		<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Duration</span>(<span style="color:#a6e22e">i</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>))
	}
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">readRLocker</span>(<span style="color:#a6e22e">i</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">wg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>, <span style="color:#a6e22e">rwM</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">RWMutex</span>) {
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>()
	<span style="color:#a6e22e">w</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rwM</span>.<span style="color:#a6e22e">RLocker</span>()

	<span style="color:#66d9ef">for</span> {
		<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Lock</span>()
		<span style="color:#a6e22e">num</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">value</span>
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;readRLocker goroutine:%d, Reading num=%d\n&#34;</span>, <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">num</span>)
		<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>)
		<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Unlock</span>()
		<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1</span>)
	}
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">read2</span>(<span style="color:#a6e22e">i</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">wg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>, <span style="color:#a6e22e">rwM</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">RWMutex</span>) {
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>()

	<span style="color:#66d9ef">for</span> {
		<span style="color:#a6e22e">rwM</span>.<span style="color:#a6e22e">RLock</span>()
		<span style="color:#a6e22e">num</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">value</span>
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;read2 goroutine:%d, Reading num=%d\n&#34;</span>, <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">num</span>)
		<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>)
		<span style="color:#a6e22e">rwM</span>.<span style="color:#a6e22e">RUnlock</span>()
		<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1</span>)
	}
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">rwMutex</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">RWMutex</span>{}
	<span style="color:#a6e22e">wg</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>{}

	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">5</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
		<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">1</span>)
		<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">writes</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">wg</span>, <span style="color:#a6e22e">rwMutex</span>)
	}

	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">10</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
		<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">1</span>)
		<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">readRLocker</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">wg</span>, <span style="color:#a6e22e">rwMutex</span>)
	}

	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">10</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
		<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">1</span>)
		<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">read2</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">wg</span>, <span style="color:#a6e22e">rwMutex</span>)
	}

	<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Wait</span>()
}

</code></pre></div><p>输出：</p>
<pre><code>writes goroutine:1, Write num=70
read2 goroutine:1, Reading num=70
read2 goroutine:6, Reading num=70
read2 goroutine:9, Reading num=70
read2 goroutine:7, Reading num=70
read2 goroutine:8, Reading num=70
read2 goroutine:4, Reading num=70
readRLocker goroutine:4, Reading num=70
readRLocker goroutine:1, Reading num=70
readRLocker goroutine:0, Reading num=70
readRLocker goroutine:8, Reading num=70
readRLocker goroutine:3, Reading num=70
readRLocker goroutine:2, Reading num=70
readRLocker goroutine:5, Reading num=70
readRLocker goroutine:9, Reading num=70
readRLocker goroutine:6, Reading num=70
read2 goroutine:2, Reading num=70
read2 goroutine:0, Reading num=70
read2 goroutine:3, Reading num=70
readRLocker goroutine:7, Reading num=70
read2 goroutine:5, Reading num=70
writes goroutine:0, Write num=70
writes goroutine:3, Write num=70
writes goroutine:2, Write num=70
writes goroutine:4, Write num=70
writes goroutine:1, Write num=93
readRLocker goroutine:5, Reading num=93
readRLocker goroutine:8, Reading num=93
read2 goroutine:4, Reading num=93
read2 goroutine:9, Reading num=93
read2 goroutine:7, Reading num=93
read2 goroutine:2, Reading num=93
read2 goroutine:8, Reading num=93
read2 goroutine:5, Reading num=93
readRLocker goroutine:0, Reading num=93
readRLocker goroutine:1, Reading num=93
readRLocker goroutine:3, Reading num=93
readRLocker goroutine:2, Reading num=93
readRLocker goroutine:4, Reading num=93
··· ···
</code></pre><hr>
<h2 id="type-cond-">
  <code>type Cond </code>
  <a class="anchor" href="#type-cond-">#</a>
</h2>
<p>功能：</p>
<blockquote>
<p>Broadcase、Signal
唤醒因wait condition而挂起goroutine，Signal只唤醒一个，而Broadcast唤醒所有。允许调用者获取基础锁Locker之后再调用唤醒，但非必需。</p>
</blockquote>
<blockquote>
<p>Wait
必须获取该锁之后才能调用Wait()方法，Wait方法在调用时会释放底层锁Locker，并且将当前goroutine挂起，直到另一个goroutine执行Signal或者Broadcase，该goroutine才有机会重新唤醒，并尝试获取Locker，完成后续逻辑。</p>
</blockquote>
<p>结构定义：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Cond</span> <span style="color:#66d9ef">struct</span> {
        <span style="color:#75715e">// L is held while observing or changing the condition
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">L</span> <span style="color:#a6e22e">Locker</span>
        <span style="color:#75715e">// contains filtered or unexported fields
</span><span style="color:#75715e"></span>}

<span style="color:#75715e">//function list:
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewCond</span>(<span style="color:#a6e22e">l</span> <span style="color:#a6e22e">Locker</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Cond</span>
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Cond</span>) <span style="color:#a6e22e">Broadcast</span>()   <span style="color:#75715e">// 广播唤醒所有wait
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Cond</span>) <span style="color:#a6e22e">Signal</span>()      <span style="color:#75715e">// 唤醒其中一个wait
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">c</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Cond</span>) <span style="color:#a6e22e">Wait</span>()        <span style="color:#75715e">// 进入等待状态，释放锁
</span></code></pre></div><p>示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;sync&#34;</span>
	<span style="color:#e6db74">&#34;time&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">tt</span>(<span style="color:#a6e22e">cd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">Cond</span>, <span style="color:#a6e22e">wg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>, <span style="color:#a6e22e">i</span> <span style="color:#66d9ef">int</span>) {
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>()
	<span style="color:#a6e22e">cd</span>.<span style="color:#a6e22e">L</span>.<span style="color:#a6e22e">Lock</span>()
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;lock: %d\n&#34;</span>, <span style="color:#a6e22e">i</span>)
	<span style="color:#a6e22e">cd</span>.<span style="color:#a6e22e">Wait</span>()
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;wait end: %d\n&#34;</span>, <span style="color:#a6e22e">i</span>)
	<span style="color:#a6e22e">cd</span>.<span style="color:#a6e22e">L</span>.<span style="color:#a6e22e">Unlock</span>()
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">l</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">Mutex</span>{}
	<span style="color:#a6e22e">w</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>{}
	<span style="color:#a6e22e">cd</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">NewCond</span>(<span style="color:#a6e22e">l</span>)

	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">10</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
		<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">1</span>)
		<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">tt</span>(<span style="color:#a6e22e">cd</span>, <span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">i</span>)
	}
	<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Send 5 Signal:&#34;</span>)
	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">5</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
		<span style="color:#a6e22e">cd</span>.<span style="color:#a6e22e">Signal</span>()   <span style="color:#75715e">//唤醒一个wait中的goroutine
</span><span style="color:#75715e"></span>	}
	<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Send Broadcast:&#34;</span>)
	<span style="color:#a6e22e">cd</span>.<span style="color:#a6e22e">Broadcast</span>()  <span style="color:#75715e">//广播唤醒所有wait中的goroutine
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Wait</span>()
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Run end!&#34;</span>)
}
</code></pre></div><p>输出：</p>
<pre><code>lock: 1
lock: 2
lock: 7
lock: 8
lock: 9
lock: 0
lock: 3
lock: 6
lock: 5
lock: 4
Send 5 Signal:
wait end: 7
wait end: 9
wait end: 2
wait end: 8
wait end: 1
Send Broadcast:
wait end: 4
wait end: 0
wait end: 3
wait end: 6
wait end: 5
Run end!
</code></pre><hr>
<h2 id="type-pool">
  <code>type Pool</code>
  <a class="anchor" href="#type-pool">#</a>
</h2>
<p>功能：
Pool 是可伸缩、并发安全的临时对象池，用来存放已经分配但暂时不用的临时对象，通过对象重用机制，缓解 GC 压力，提高程序性能。</p>
<p>PS：如果你使用的Pool代码所需的东西不是大概同质的，那么从Pool中转化检索到所需要的内容的时间可能比重新实例化内容要花费的时间更多。</p>
<p>结构定义：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Pool</span> <span style="color:#66d9ef">struct</span> {
        <span style="color:#75715e">// New optionally specifies a function to generate
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// a value when Get would otherwise return nil.
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// It may not be changed concurrently with calls to Get.
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">New</span> <span style="color:#66d9ef">func</span>() <span style="color:#66d9ef">interface</span>{}
        <span style="color:#75715e">// contains filtered or unexported fields
</span><span style="color:#75715e"></span>}

<span style="color:#75715e">//function list:
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Pool</span>) <span style="color:#a6e22e">Get</span>() <span style="color:#66d9ef">interface</span>{}  <span style="color:#75715e">//从 Pool 中获取元素，元素数量 -1，当 Pool 中没有元素时，会调用 New 生成元素，新元素不会放入 Pool 中，若 New 未定义，则返回 nil
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Pool</span>) <span style="color:#a6e22e">Put</span>(<span style="color:#a6e22e">x</span> <span style="color:#66d9ef">interface</span>{}) <span style="color:#75715e">// 把用完的元素放回Pool中
</span></code></pre></div><p>示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">poolTest</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;io/ioutil&#34;</span>
	<span style="color:#e6db74">&#34;log&#34;</span>
	<span style="color:#e6db74">&#34;net&#34;</span>
	<span style="color:#e6db74">&#34;sync&#34;</span>
	<span style="color:#e6db74">&#34;testing&#34;</span>
	<span style="color:#e6db74">&#34;time&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">connectToService</span>() <span style="color:#66d9ef">interface</span>{} {
	<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">struct</span> {}{}
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">startNetworkDaemon</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span> {
	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">wg</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>
	<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">1</span>)
	<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
		<span style="color:#a6e22e">connPool</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">warmServiceConnCache</span>()
		<span style="color:#a6e22e">server</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Listen</span>(<span style="color:#e6db74">&#34;tcp&#34;</span>, <span style="color:#e6db74">&#34;localhost:8080&#34;</span>)
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;cannot listen: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
		}
		<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">Close</span>()
		<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>()

		<span style="color:#66d9ef">for</span> {
			<span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">Accept</span>()
			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
				<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;cannot accept connection: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
			}
			<span style="color:#a6e22e">svcConn</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">connPool</span>.<span style="color:#a6e22e">Get</span>()
			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintln</span>(<span style="color:#a6e22e">conn</span>, <span style="color:#e6db74">&#34;&#34;</span>)
			<span style="color:#a6e22e">connPool</span>.<span style="color:#a6e22e">Put</span>(<span style="color:#a6e22e">svcConn</span>)
			<span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Close</span>()
		}
	}()

	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">wg</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">init</span>() {
	<span style="color:#a6e22e">daemonStarted</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">startNetworkDaemon</span>()
	<span style="color:#a6e22e">daemonStarted</span>.<span style="color:#a6e22e">Wait</span>()
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">BenchmarkNetworkRequest</span>(<span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">B</span>) {
	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">N</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
		<span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Dial</span>(<span style="color:#e6db74">&#34;tcp&#34;</span>, <span style="color:#e6db74">&#34;localhost:8080&#34;</span>)
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;cannot dial host: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
		}
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ioutil</span>.<span style="color:#a6e22e">ReadAll</span>(<span style="color:#a6e22e">conn</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;cannot read: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
		}
		<span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Close</span>()
	}
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">warmServiceConnCache</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">Pool</span> {
	<span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">Pool</span>{
		<span style="color:#a6e22e">New</span>: <span style="color:#a6e22e">connectToService</span>,
	}

	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">10</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
		<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">Put</span>(<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">New</span>())
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">p</span>
}
</code></pre></div><p>输出：</p>
<pre><code>goos: darwin
goarch: amd64
pkg: go-bfzd/poolTest
BenchmarkNetworkRequest-4           1000          10610437 ns/op
PASS
ok      go-bfzd/poolTest        38.099s

</code></pre><hr>
<h2 id="type-map">
  <code>type Map</code>
  <a class="anchor" href="#type-map">#</a>
</h2>
<p>功能：
sync.Map这个数据结构是线程安全的（基本类型Map结构体在并发读写时会panic严重错误），它填补了Map线程不安全的缺陷，不过最好只在需要的情况下使用。它一般用于并发模型中对同一类map结构体的读写，或其他适用于sync.Map的情况。</p>
<p>结构定义：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Map</span> <span style="color:#66d9ef">struct</span> {
        <span style="color:#75715e">// contains filtered or unexported fields
</span><span style="color:#75715e"></span>}

<span style="color:#75715e">//function list:
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Map</span>) <span style="color:#a6e22e">Delete</span>(<span style="color:#a6e22e">key</span> <span style="color:#66d9ef">interface</span>{})  <span style="color:#75715e">// 删除对应key的值
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Map</span>) <span style="color:#a6e22e">Load</span>(<span style="color:#a6e22e">key</span> <span style="color:#66d9ef">interface</span>{}) (<span style="color:#a6e22e">value</span> <span style="color:#66d9ef">interface</span>{}, <span style="color:#a6e22e">ok</span> <span style="color:#66d9ef">bool</span>) <span style="color:#75715e">// 获取key对应的值
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Map</span>) <span style="color:#a6e22e">LoadOrStore</span>(<span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">value</span> <span style="color:#66d9ef">interface</span>{}) (<span style="color:#a6e22e">actual</span> <span style="color:#66d9ef">interface</span>{}, <span style="color:#a6e22e">loaded</span> <span style="color:#66d9ef">bool</span>)   <span style="color:#75715e">//获取对应key的值，成功则返回true和value，不存在该key则将值存进该key并返回false和存进去的value
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Map</span>) <span style="color:#a6e22e">Range</span>(<span style="color:#a6e22e">f</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">value</span> <span style="color:#66d9ef">interface</span>{}) <span style="color:#66d9ef">bool</span>)  <span style="color:#75715e">// 遍历map中的所有key
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Map</span>) <span style="color:#a6e22e">Store</span>(<span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">value</span> <span style="color:#66d9ef">interface</span>{})  <span style="color:#75715e">// 将value存进对应的key，存在则覆盖
</span></code></pre></div><p>示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// sync.Map是线程安全的，一般用于并发模型中，本例不存在并发，只演示各个接口的用法
</span><span style="color:#75715e"></span>
<span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;fmt&#34;</span>
	<span style="color:#e6db74">&#34;sync&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">sMap</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">Map</span>{}

	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;=====================Store=======================&#34;</span>)

	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;store: key=1, value=jay&#34;</span>)
	<span style="color:#a6e22e">sMap</span>.<span style="color:#a6e22e">Store</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;jay&#34;</span>)
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;store: key=2, value=lhj&#34;</span>)
	<span style="color:#a6e22e">sMap</span>.<span style="color:#a6e22e">Store</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;lhj&#34;</span>)
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;store: key=2, value=lhj-hhh&#34;</span>)
	<span style="color:#a6e22e">sMap</span>.<span style="color:#a6e22e">Store</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;lhj-hhh&#34;</span>)


	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;=====================LoadOrStore=======================&#34;</span>)

	<span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">succeed</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sMap</span>.<span style="color:#a6e22e">LoadOrStore</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;jays&#34;</span>)
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;key=1 store: value=jays; result: load_succeed=%t, value=%v\n&#34;</span>, <span style="color:#a6e22e">succeed</span>, <span style="color:#a6e22e">result</span>)

	<span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">succeed</span> = <span style="color:#a6e22e">sMap</span>.<span style="color:#a6e22e">LoadOrStore</span>(<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;lhj-s&#34;</span>)
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;key=2 store: value=lhj-s; result: load_succeed=%t, value=%v\n&#34;</span>, <span style="color:#a6e22e">succeed</span>, <span style="color:#a6e22e">result</span>)

	<span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">succeed</span> = <span style="color:#a6e22e">sMap</span>.<span style="color:#a6e22e">LoadOrStore</span>(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;jay-lhj&#34;</span>)
	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;key=3 store: value=jay-lhj; result: load_succeed=%t, value=%v\n&#34;</span>, <span style="color:#a6e22e">succeed</span>, <span style="color:#a6e22e">result</span>)



	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;=====================Load key:1~4=======================&#34;</span>)

	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">val</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sMap</span>.<span style="color:#a6e22e">Load</span>(<span style="color:#ae81ff">1</span>); <span style="color:#a6e22e">ok</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;key=1, value=%v\n&#34;</span>, <span style="color:#a6e22e">val</span>)
	}<span style="color:#66d9ef">else</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;key=1, load failed\n&#34;</span>)
	}

	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">val</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sMap</span>.<span style="color:#a6e22e">Load</span>(<span style="color:#ae81ff">2</span>); <span style="color:#a6e22e">ok</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;key=2, value=%v\n&#34;</span>, <span style="color:#a6e22e">val</span>)
	}<span style="color:#66d9ef">else</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;key=2, load failed\n&#34;</span>)
	}

	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">val</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sMap</span>.<span style="color:#a6e22e">Load</span>(<span style="color:#ae81ff">3</span>); <span style="color:#a6e22e">ok</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;key=3, value=%v\n&#34;</span>, <span style="color:#a6e22e">val</span>)
	}<span style="color:#66d9ef">else</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;key=3, load failed\n&#34;</span>)
	}

	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">val</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sMap</span>.<span style="color:#a6e22e">Load</span>(<span style="color:#ae81ff">4</span>); <span style="color:#a6e22e">ok</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;key=4, value=%v\n&#34;</span>, <span style="color:#a6e22e">val</span>)
	}<span style="color:#66d9ef">else</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;key=4, load failed\n&#34;</span>)
	}

	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;======================Delete======================&#34;</span>)

	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;delete key=1&#34;</span>)
	<span style="color:#a6e22e">sMap</span>.<span style="color:#a6e22e">Delete</span>(<span style="color:#ae81ff">1</span>)

	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;=====================Range=======================&#34;</span>)
	<span style="color:#a6e22e">sMap</span>.<span style="color:#a6e22e">Range</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">value</span> <span style="color:#66d9ef">interface</span>{}) <span style="color:#66d9ef">bool</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;key=%v value=%v\n&#34;</span>, <span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">value</span>)
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>
	})

}
</code></pre></div><p>输出：</p>
<pre><code>=====================Store=======================
store: key=1, value=jay
store: key=2, value=lhj
store: key=2, value=lhj-hhh
=====================LoadOrStore=======================
key=1 store: value=jays; result: load_succeed=true, value=jay
key=2 store: value=lhj-s; result: load_succeed=true, value=lhj-hhh
key=3 store: value=jay-lhj; result: load_succeed=false, value=jay-lhj
=====================Load key:1~4=======================
key=1, value=jay
key=2, value=lhj-hhh
key=3, value=jay-lhj
key=4, load failed
======================Delete======================
delete key=1
=====================Range=======================
key=2 value=lhj-hhh
key=3 value=jay-lhj
</code></pre></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>



  <h2 id="rewardcode" style="color:#d0021b">
      大侠的赏赐，是我持续创作的动力，感谢！ 
  </h2>

  <div style="width:100%; text-align:center;">
	  <div style="width:100%;text-align: center;">
		  <img src="https://gitee.com/jayos/imgs/raw/master/20210809/wxgzh.jpg" style="width:200px;height:200px;float:left;" alt="微信公众号">
		  <img src="https://gitee.com/jayos/imgs/raw/master/20210809/wxds.jpg" style="width:200px;height:200px;float:center;" alt="赞赏码">
		  <img src="https://gitee.com/jayos/imgs/raw/master/20210809/zfbds.jpg" style="width:200px;height:200px;float:right;" alt="赞赏码">
	  </div>
  </div>



<script src="https://utteranc.es/client.js"
repo="jageros/note"
issue-term="pathname"
theme="github-light"
crossorigin="anonymous"
async>
</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#type-once"><code>type Once</code></a></li>
        <li><a href="#type-waitgroup"><code>type WaitGroup</code></a></li>
        <li><a href="#type-locker"><code>type Locker</code></a></li>
        <li><a href="#type-rwmutex"><code>type RWMutex</code></a></li>
        <li><a href="#type-cond-"><code>type Cond </code></a></li>
        <li><a href="#type-pool"><code>type Pool</code></a></li>
        <li><a href="#type-map"><code>type Map</code></a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












